!function(e){function i(i){function s(i,s,r){P||(P=!0,f=i.getCanvas(),v=e(f).parent(),b=i.getOptions(),i.setData(t(i.getData())))}function t(i){for(var s=0,t=0,r=0,a=b.series.pie.combine.color,l=[],n=0;n<i.length;++n){var o=i[n].data;e.isArray(o)&&1==o.length&&(o=o[0]),e.isArray(o)?!isNaN(parseFloat(o[1]))&&isFinite(o[1])?o[1]=+o[1]:o[1]=0:o=!isNaN(parseFloat(o))&&isFinite(o)?[1,+o]:[1,0],i[n].data=[o]}for(var n=0;n<i.length;++n)s+=i[n].data[0][1];for(var n=0;n<i.length;++n){var o=i[n].data[0][1];o/s<=b.series.pie.combine.threshold&&(t+=o,r++,a||(a=i[n].color))}for(var n=0;n<i.length;++n){var o=i[n].data[0][1];(r<2||o/s>b.series.pie.combine.threshold)&&l.push(e.extend(i[n],{data:[[1,o]],color:i[n].color,label:i[n].label,angle:o*Math.PI*2/s,percent:o/(s/100)}))}return r>1&&l.push({data:[[1,t]],color:a,label:b.series.pie.combine.label,angle:t*Math.PI*2/s,percent:t/(s/100)}),l}function r(i,s){function t(){A.clearRect(0,0,n,o),v.children().filter(".pieLabel, .pieLabelBackground").remove()}function r(){var e=b.series.pie.shadow.left,i=b.series.pie.shadow.top,s=b.series.pie.shadow.alpha,t=b.series.pie.radius>1?b.series.pie.radius:w*b.series.pie.radius;if(!(t>=n/2-e||t*b.series.pie.tilt>=o/2-i||t<=10)){A.save(),A.translate(e,i),A.globalAlpha=s,A.fillStyle="#000",A.translate(k,M),A.scale(1,b.series.pie.tilt);for(var r=1;r<=10;r++)A.beginPath(),A.arc(0,0,t,0,2*Math.PI,!1),A.fill(),t-=r;A.restore()}}function l(){function i(e,i,s){e<=0||isNaN(e)||(s?A.fillStyle=i:(A.strokeStyle=i,A.lineJoin="round"),A.beginPath(),Math.abs(e-2*Math.PI)>1e-9&&A.moveTo(0,0),A.arc(0,0,r,l,l+e/2,!1),A.arc(0,0,r,l+e/2,l+e,!1),A.closePath(),l+=e,s?A.fill():A.stroke())}function s(){function i(i,s,t){if(0==i.data[0][1])return!0;var a,l=b.legend.labelFormatter,p=b.series.pie.label.formatter;a=l?l(i.label,i):i.label,p&&(a=p(a,i));var h=(s+i.angle+s)/2,g=k+Math.round(Math.cos(h)*r),c=M+Math.round(Math.sin(h)*r)*b.series.pie.tilt,u="<span class='pieLabel' id='pieLabel"+t+"' style='position:absolute;top:"+c+"px;left:"+g+"px;'>"+a+"</span>";v.append(u);var d=v.children("#pieLabel"+t),f=c-d.height()/2,w=g-d.width()/2;if(d.css("top",f),d.css("left",w),0-f>0||0-w>0||o-(f+d.height())<0||n-(w+d.width())<0)return!1;if(0!=b.series.pie.label.background.opacity){var P=b.series.pie.label.background.color;null==P&&(P=i.color);var A="top:"+f+"px;left:"+w+"px;";e("<div class='pieLabelBackground' style='position:absolute;width:"+d.width()+"px;height:"+d.height()+"px;"+A+"background-color:"+P+";'></div>").css("opacity",b.series.pie.label.background.opacity).insertBefore(d)}return!0}for(var s=t,r=b.series.pie.label.radius>1?b.series.pie.label.radius:w*b.series.pie.label.radius,a=0;a<h.length;++a){if(h[a].percent>=100*b.series.pie.label.threshold&&!i(h[a],s,a))return!1;s+=h[a].angle}return!0}var t=Math.PI*b.series.pie.startAngle,r=b.series.pie.radius>1?b.series.pie.radius:w*b.series.pie.radius;A.save(),A.translate(k,M),A.scale(1,b.series.pie.tilt),A.save();for(var l=t,p=0;p<h.length;++p)h[p].startAngle=l,i(h[p].angle,h[p].color,!0);if(A.restore(),b.series.pie.stroke.width>0){A.save(),A.lineWidth=b.series.pie.stroke.width,l=t;for(var p=0;p<h.length;++p)i(h[p].angle,b.series.pie.stroke.color,!1);A.restore()}return a(A),A.restore(),!b.series.pie.label.show||s()}if(v){var n=i.getPlaceholder().width(),o=i.getPlaceholder().height(),p=v.children().filter(".legend").children().width()||0;A=s,
// WARNING: HACK! REWRITE THIS CODE AS SOON AS POSSIBLE!
P=!1,w=Math.min(n,o/b.series.pie.tilt)/2,M=o/2+b.series.pie.offset.top,k=n/2,"auto"==b.series.pie.offset.left?(b.legend.position.match("w")?k+=p/2:k-=p/2,k<w?k=w:k>n-w&&(k=n-w)):k+=b.series.pie.offset.left;var h=i.getData(),g=0;do g>0&&(w*=.95),g+=1,t(),b.series.pie.tilt<=.8&&r();while(!l()&&g<10);g>=10&&(t(),v.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),i.setSeries&&i.insertLegend&&(i.setSeries(h),i.insertLegend())}}function a(e){if(b.series.pie.innerRadius>0){e.save();var i=b.series.pie.innerRadius>1?b.series.pie.innerRadius:w*b.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=b.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=b.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function l(e,i){for(var s=!1,t=-1,r=e.length,a=r-1;++t<r;a=t)(e[t][1]<=i[1]&&i[1]<e[a][1]||e[a][1]<=i[1]&&i[1]<e[t][1])&&i[0]<(e[a][0]-e[t][0])*(i[1]-e[t][1])/(e[a][1]-e[t][1])+e[t][0]&&(s=!s);return s}function n(e,s){for(var t,r,a=i.getData(),n=i.getOptions(),o=n.series.pie.radius>1?n.series.pie.radius:w*n.series.pie.radius,p=0;p<a.length;++p){var h=a[p];if(h.pie.show){if(A.save(),A.beginPath(),A.moveTo(0,0),A.arc(0,0,o,h.startAngle,h.startAngle+h.angle/2,!1),A.arc(0,0,o,h.startAngle+h.angle/2,h.startAngle+h.angle,!1),A.closePath(),t=e-k,r=s-M,A.isPointInPath){if(A.isPointInPath(e-k,s-M))return A.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:p}}else{if(l([[0,0],[o*Math.cos(h.startAngle),o*Math.sin(h.startAngle)],[o*Math.cos(h.startAngle+h.angle/4),o*Math.sin(h.startAngle+h.angle/4)],[o*Math.cos(h.startAngle+h.angle/2),o*Math.sin(h.startAngle+h.angle/2)],[o*Math.cos(h.startAngle+h.angle/1.5),o*Math.sin(h.startAngle+h.angle/1.5)],[o*Math.cos(h.startAngle+h.angle),o*Math.sin(h.startAngle+h.angle)]],[t,r]))return A.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:p}}A.restore()}}return null}function o(e){h("plothover",e)}function p(e){h("plotclick",e)}function h(e,s){var t=i.offset(),r=parseInt(s.pageX-t.left),a=parseInt(s.pageY-t.top),l=n(r,a);if(b.grid.autoHighlight)for(var o=0;o<y.length;++o){var p=y[o];p.auto!=e||l&&p.series==l.series||c(p.series)}l&&g(l.series,e);var h={pageX:s.pageX,pageY:s.pageY};v.trigger(e,[h,l])}function g(e,s){var t=u(e);t==-1?(y.push({series:e,auto:s}),i.triggerRedrawOverlay()):s||(y[t].auto=!1)}function c(e){null==e&&(y=[],i.triggerRedrawOverlay());var s=u(e);s!=-1&&(y.splice(s,1),i.triggerRedrawOverlay())}function u(e){for(var i=0;i<y.length;++i){if(y[i].series==e)return i}return-1}function d(e,i){function s(e){e.angle<=0||isNaN(e.angle)||(i.fillStyle="rgba(255, 255, 255, "+t.series.pie.highlight.opacity+")",i.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&i.moveTo(0,0),i.arc(0,0,r,e.startAngle,e.startAngle+e.angle/2,!1),i.arc(0,0,r,e.startAngle+e.angle/2,e.startAngle+e.angle,!1),i.closePath(),i.fill())}var t=e.getOptions(),r=t.series.pie.radius>1?t.series.pie.radius:w*t.series.pie.radius;i.save(),i.translate(k,M),i.scale(1,t.series.pie.tilt);for(var l=0;l<y.length;++l)s(y[l].series);a(i),i.restore()}var f=null,v=null,b=null,w=null,k=null,M=null,P=!1,A=null,y=[];i.hooks.processOptions.push(function(e,i){i.series.pie.show&&(i.grid.show=!1,"auto"==i.series.pie.label.show&&(i.legend.show?i.series.pie.label.show=!1:i.series.pie.label.show=!0),"auto"==i.series.pie.radius&&(i.series.pie.label.show?i.series.pie.radius=.75:i.series.pie.radius=1),i.series.pie.tilt>1?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))}),i.hooks.bindEvents.push(function(e,i){var s=e.getOptions();s.series.pie.show&&(s.grid.hoverable&&i.unbind("mousemove").mousemove(o),s.grid.clickable&&i.unbind("click").click(p))}),i.hooks.processDatapoints.push(function(e,i,t,r){e.getOptions().series.pie.show&&s(e,i,t,r)}),i.hooks.drawOverlay.push(function(e,i){e.getOptions().series.pie.show&&d(e,i)}),i.hooks.draw.push(function(e,i){e.getOptions().series.pie.show&&r(e,i)})}var s={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:i,options:s,name:"pie",version:"1.1"})}(jQuery);